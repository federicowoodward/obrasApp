<p-button
  type="button"
  [label]="'Faltantes (' + svc.pendingCount() + ')'"
  (click)="openDrawer()"
  styleClass="glow-pulse"
  variant="outlined"
  [disabled]="svc.pendingCount() === 0"
/>

<p-drawer
  header="Faltantes"
  [(visible)]="visible"
  position="right"
  [dismissible]="true"
>
  <ng-template #content>
    <div class="flex align-items-center justify-content-between w-full pb-2">
      <div class="text-sm opacity-80">
        Pendientes: <b>{{ svc.pendingCount() }}</b>
        <span *ngIf="svc.urgentCount() > 0">
          â€¢ Urgentes: <b>{{ svc.urgentCount() }}</b></span
        >
      </div>
      <div class="flex flex-column sm:flex-row align-items-end gap-2">
        <p-button
          size="small"
          label="Actualizar"
          outlined
          (click)="refresh()"
          [loading]="svc.loading()"
        />
      </div>
    </div>

    <div *ngIf="svc.pendingCount() === 0" class="py-3 opacity-70">
      No hay faltantes pendientes ðŸŽ‰
    </div>

    <div
      *ngIf="svc.pendingCount() > 0"
      class="flex flex-column gap-2 pt-2 w-full"
    >
      <p-message
        *ngFor="let m of svc.urgentPending()"
        severity="warn"
        variant="outlined"
        class="pt-1 cursor-pointer"
        (click)="goToRegistry()"
      >
        <div class="flex flex-column gap-2 w-full">
          <div class="flex align-items-center justify-content-between w-full">
            <h4 class="text-2xl m-0">
              {{ m.title }}
              <p-tag
                *ngIf="m.urgent"
                severity="danger"
                value="Urgente"
                class="ml-2"
              />
            </h4>

            <div class="flex gap-2 justify-content-center align-items-center">
              <p>Ver</p>
              <p class="pi pi-arrow-right"></p>
            </div>
          </div>
          <p
            class="text-white pt-1 word-all whitespace-normal w-full line-clamp-3"
          >
            {{ m.text }}
          </p>
          <div class="text-xs opacity-70">
            Obra #{{ m.construction.id }} â€¢ Obrero: {{ m.constructionWorker.name
            || ('#' + m.constructionWorker.id) }} â€¢ {{ m.createdAt | date :
            'short' }}
          </div>
        </div>
      </p-message>
    </div>
  </ng-template>
  <ng-template #footer>
    <div class="flex justify-content-center">
      <p-button size="small" label="Ver registro" (click)="goToRegistry()" />
    </div>
  </ng-template>
</p-drawer>
